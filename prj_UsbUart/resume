
2014.05.16
    programs\system\loaddrv\loadpe.asm
        загрузка PE-драйвера

    programs\other\kpack\unpack.exe
        распаковщик, OsDos/Linux

    drivers\ethernet\netNULL.asm
        примитив драйвера сетевого адаптера

2014.05.21
    ВАЖНО: управление модификацией имён в OpenWatcom !  :))
        #pragma aux __stdcall "*"           \
           parm routine [ ]               \
           value struct struct caller [ ] \
           modify [eax ecx edx]
        или проще :) так -
    #pragma calling(push, __stdcall)
    #pragma calling(push, __cdecl)
    #pragma aux __stdcall   "*"
    #pragma aux __cdecl     "*"
    ...
    #pragma calling(pop)    //  anti "#pragma calling(push ..."
    #pragma calling(pop)

        "*" -модификатор имени процедуры, так - как есть или
        "_*" -будет например "_main" или
        "_*@xyz" -будет например "_main@xyz" и т.д. и т.п.

2014.06.05
    попытка использовать GNU|gcc
       объявления импортов (не ELF а PE) и асинхронные вызовы процедур в RAW-режиме   КААК?   :((
      полный провал :)        уж лучше OpenWatcom, вот уж "Portable Executable" :))

2014.06.22
    имя файла usbother.sys важно ТОЛЬКО при авто-загрузке из ядра (/rd/1/DRIVERS)
    НО имя самого драйвера обязательно "usbother", иначе не отработает RegUSBDriver()

    выдрать с SVN только файлы из указываемого каталога, а не всю огромную ветку
        svn co --depth files svn://kolibrios.org/programs/other/kpack/trunk

2014.11.17
    win.cmd gcc.exe -Xlinker --enable-stdcall-fixup usbcom.c  ../my_clib.a  my_kernel_api.obj import_gcc.def

      --enable-stdcall-fixup             Link _sym to _sym@nn without warnings

    ld_lst:////////////////////////////////////////////////////////////////////////////////////////
--enable-stdcall-fixup
--enable-auto-import

--entry=_start

core.def                                         -т.е. соединяет _sym с _sym@nn молча :)

    core.def://////////////////////////////////////////////////////////////////////////////////////

LIBRARY core.dll

EXPORTS
RegUSBDriver@12
USBGetParam@8
kfree
kmalloc
SysMsgBoardStr

    win.cmd dlltool -d core.def  -l core.a
    win.cmd gcc.exe -c usbcom.c -nostdlib
    win.cmd ld.exe -o usbcom_gcc.sys @ld_lst usbcom.o my_kernel_api.obj ../my_clib.a core.a
    win.cmd strip.exe usbcom_gcc.sys

2014.11.18
    core.def
        ; сочетнание "==" нужно для подавления собак  ;)
        RegUSBDriver@12 ==RegUSBDriver
        e.t.c.

    с импортом/экспортом "собак" справился :)
    а вот с __saveregs :((
    __saveregs  бесполезен/пуст :)  2014.11.27

2014.11.25

    #   2014.11.25  RVA/VA и иже с ними
http://uinc.ru/articles/41/
    #   утилиты LordPE и PE Tools

2014.11.16
    теперь работоспособны модули и от MinGW и MSVC

    link /nologo /SUBSYSTEM:windows /fixed:NO /ENTRY:start /OUT:$@ $** ..\my_clib.msvc.lib
                                    ^^^^^^^^^
                                 наличие  .reloc  ^_^

    для MinGW   "подробности" в GNUmakefile     ^_^

2014.11.28
    Watcom:
        попробывал использовать имеющийся libc (strcpy, memcpy, snprintf)
        sys-файл ~30K вместо 5K  :((    + импорт из user32.dll  :)))

        rdos:
            sys-файл ~12K

2015.02.02
    попытка использовать EmbarCadero:
        компиляция  и сборка бибилиотек -OK
        но линковка:
            своеобразное НЕПРЕОБРАЗОВАНИЕ имён __stdcall, не _xxx@nn - а просто xxx
            необходимость WinMain/main
            присоединение kernel32.dll и user32.dll
        ОНО исключительно для уиндоус, ну его к лешему :((

2015.02.07
    контакт состоялся :))
    Prolific и AnyDATA работают OK :))
    проблема возникла с Huawei, не отвечает, иногда проскакивает символ 'A'
    оказалось : intr-точка и out-точка у него имеют один адрес !  ^_^
    пока отключил запрос состояния линии (intr-запрос) - РАБОТАЕТ :))

2015.02.21
    модемы OK :))
    com-порты не работают :((
        линиии RTS/DTR супер-пупер замечательно, а приём/передача - только при заглушке !
        как это может быть - не проходит настройка com-порта !!
    адрес поступаемый от "прикладухи" передавать дальше в ядро НЕ НАДО !!
        скопировать содержимое К СЕБЕ и СВОЙ уже адрес - полный вперёд. Вот так вот  ;)

2015.03.18
    CDC/ACM FTDI CP210x и модемы Huawei/AnyData  -работают
    и года не прошло :))

    итого:
        bulk-запрос отрабатывает callback только при поступлении данных или отключении устройств;
        intr-запрос отрабатывает callback только при изменении состояния линии и НЕ ПЕРЕЗАПУСКАЕТСЯ;

2015.03.20
    в описании CDC/ACM "6.5.4 SerialState"  описан запрос о состоянии линии через CTRL-точку.
    пытаюсь этим воспользоваться (любопытства ради).
        -prolific весьма плохо проявляет себя :))
        -возможно, если уж есть INTR-точка, то нужно использовать именно её :|

        -запрос завершается с кодом 4 (устр. остановлено) в лог ядра
         прёт какая-то чушь, но всё это не критично :) ОС работает
         прикладуха и драйвер тоже; ну это всё к лешему;
         оставляю #define NO_INTR (что-бы помнить, о "лешем")

        -выходит: стандарт CDC/ACM соблюдается частично,
            а ведь Prolific, Huawei и AnyDATA работают по INTR
            , ну и ладно :)

2015.03.24
    снова возникла неразбириха с линиями CTS,DSR,CD,RIng
        итак  ^_^  в usbuart-модуле значение статуса линии хранится КАК-ЕСТЬ,
        а при  запросе MSG_GET_STATUS_LINE наружу выдаём значение в соответствии
          с COM-style , т.о.
            для "prolific e.t.c" проводим преобразование,
            а для CP210x и FTDI не надо, и так подходит :)

2015.04.xx
    "#define NO_INTR" удалён "к лешему" :)

2015.04.15
    тот формат передачи! , что описан в конце ftdi_sio.h   linux-3-18
    наверное нужен для м\с типа  FT2232D (эдакие com-хабы)
    сделал посылку для FTDI обычной, работает млин :)) и двух недель не прошло %|

2016.12.20
    CP2103 не работает после закрытия устройства (ProcCmd_CLOSE_DEVICE ... CP210X_UART_DISABLE)
    подозрение! на PIPE-ресурсы usb-стека :((
    можно переоткрывать эти pip-ы, но как быть с нулевой пипой ^_^
    пока просто отключил отключение :)

2017.02.14
    CP2103 -конфликт запросов о состоянии линии и задании конфигурации
        , возможно это стек - хз.

2017.02.16
    Lcp210x__usb_control_msg    примочка ^_^ для CP210x
    состояние линий! и соответственно управление - ведётся  по нулевой точке, видимо происходит столкновения-гонки в CleverMouse-стеке
    здесь, в поток опроса состояния линий вклиниваю управляющий запрос ^_^
        цель: все запросы по нулевой точке вести через одну "трубу"  ^_^
